<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Online checker</title>

    <style>
        html{
    background-color: #bcecff;
    margin-left: 5px;
    }
    form{
        display: block;
    }
    /* .container{
        display: flex;
        flex-direction: row;
    } */
    .html2{
        margin-left: 5px;
    }
    .results{
        display: none; 
    }
    table{
        border: 1px solid black;
        margin: 5px 0 0 0 ;
        border-collapse: collapse;
        width: 100%;
    }
    th{
        background-color: honeydew;
    }
    tr {
        border: 1px solid green;
        padding: 8px;
    }
    .loading {
        display: none;
        font-size: 2em;
        animation: effect 2s infinite;
        text-align: center;
    }
    
    @keyframes effect {
        0% {
        color: black;
        }
        50% {
        color: red;
        }
    </style>
    </head>
    <body>
        <h1>Intershop 7 - product availability status (beta)</h1>

        <div class="countrySelect">
            <p>Please select country:</p>
            <input type="radio" id="sweden" name="country" value="https://www.elgiganten.se/product/">
            <label for="sweden">Sweden</label><br>
            <input type="radio" id="denmark" name="country" value="https://www.elgiganten.dk/product/">
            <label for="denmark">Denmark</label><br>
            <input type="radio" id="finland" name="country" value="https://www.gigantti.fi/product/">
            <label for="finland">Finland</label><br>
            <input type="radio" id="norway" name="country" value="https://www.elkjop.no/product/" checked>
            <label for="norway">Norway</label><br>
        </div>
<br>
        <form class="input">
            <label>Paste articles here:<br></label>
            <textarea name="Article codes" id="inputText" cols="30" rows="10"></textarea><br>
            <button type="button" class="btn">Check Article online stock / delivery date</button>
            <button type="button" class="clear">Clear</button>
        </form>
        <div class="container">
            <div class="loading">
                <h2>Loading</h2>
            </div>
            <div class="results"></div>
            <div>
                <table class="testResults">

                </table>
            </div>
       </div>
        <script>
            const message = document.querySelector("#inputText");
const button = document.querySelector(".btn");
const button2 = document.querySelector(".clear");
const loader = document.querySelector(".loading");


let textValue = "";
let country;

const norway = "https://www.elkjop.no/product/";
const sweden = "https://www.elgiganten.se/product/";
const denmark = "https://www.elgiganten.dk/product/";
const finland = "https://www.gigantti.fi/product/";

const html = document.querySelector(".results");
const html2 = document.querySelector(".testResults");

message.onkeyup = function logText() {
    console.log(event.target.value);
    const textValue = event.target.value;

    async function checkStock(textValue){
    
        var lines = textValue.split('\n');
        for(var i = 0;i < lines.length;i++){
            //code here using lines[i] which will give you each line
            let artNr = lines[i];
            console.log(artNr);
            let country = document.querySelector('input[name="country"]:checked').value;
            console.log(country);
            try{

                // fetch result
                const result = await fetch(country + artNr + "/");
                console.log(result);
                const text = await result.text();

                // if (HER MÅ DET SETTES IF PÅ OM BODY CLASS INNEHOLDER 'productdetail') - har fikset workaround
                const regex = RegExp('product-title');
                const regex2 = RegExp('button-wrap cas two-inline only-one-button')
                console.log(regex.test(text));
                console.log(regex2.test(text));

                if(regex.test(text) === true){
                                        // console.log(text);
                    console.log(text.match(/<span\s+class="checkout-spacing">[\S\s]*?<\/span>/i));
                    const avail = text.match(/<span\s+class="checkout-spacing">[\S\s]*?<\/span>/i);
                    console.log(text.match(/<span\s+class="items-in-stock align-left">[\S\s]*?<\/span>/i));
                    const avail2 = text.match(/<span\s+class="items-in-stock align-left">[\S\s]*?<\/span>/i);

                    // available? (denne delen må ferdigstilles)
                    var notAvailable = document.getElementsByClassName('button-wrap cas two-inline only-one-button');


                    // kode som skaper html:
                    if(avail === null && avail2 === null){
                        html.innerHTML += `<P>X Article: <b>${artNr}</b>  Status: Not online<a href="${country}${artNr}/">Inspect</a></p>`;
                        html2.innerHTML += `<tr><td>X</td><td>${artNr}</td><td>No buy button</td><td><a href="${country}${artNr}/">Inspect</a></td>`;
                    }else if(regex2.test(text) === true){
                        html.innerHTML += `<P>X Article: <b>${artNr}</b>  Status: Not online<a href="${country}${artNr}/">Inspect</a></p>`;
                        html2.innerHTML += `<tr><td>X</td><td>${artNr}</td><td>No buy button</td><td><a href="${country}${artNr}/">Inspect</a></td>`;
                    }else if(avail2 === null){
                        html.innerHTML += `<p>X1 Article: <b>${artNr}</b>   Status: ${avail}<a href="${country}${artNr}/">Inspect</a></p>`;
                        html2.innerHTML += `<tr><td>X1</td><td>${artNr}</td><td>${avail}</td><td><a href="${country}${artNr}/">Inspect</a></td>`;
                    }else{
                        html.innerHTML += `<p>X2 Article: <b>${artNr}</b>   Status: ${avail2}<a href="${country}${artNr}/">Inspect</a></p>`;
                        html2.innerHTML += `<tr><td>X2</td><td>${artNr}</td><td>${avail2}</td><td><a href="${country}${artNr}/">Inspect</a></td>`;
                        }          

                }else{
                    html.innerHTML += `<P>Z Article: <b>${artNr}</b>  Status: Not online<a href="${country}${artNr}/">Inspect</a></p>`;    
                    html2.innerHTML += `<tr><td>Z</td><td>${artNr}</td><td>Not Online</td><td><a href="${country}${artNr}/">Inspect</a></td>`;
                }
                // console.log(html.innerHTML);
            }
            catch(error){
                console.log(error);
            }   
        }
        loader.style.display = 'none';
    }
    button.onclick = function(){
        loader.style.display = 'block';
        html2.innerHTML = "<tr><th>ID</th><th>Article</th><th>Article Status</th><th>Link</th>";
        checkStock(textValue);
    }
}

button2.onclick = function(){
    html.innerHTML = "";
    html2.innerHTML = "<tr><th>ID</th><th>Article</th><th>Article Status</th><th>Link</th>";
}</script>
    </body>
</html>